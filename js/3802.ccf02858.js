"use strict";(self["webpackChunkjust_sell"]=self["webpackChunkjust_sell"]||[]).push([[3802],{2729:function(e,t,a){a.d(t,{Z:function(){return h}});var l=a(3396),n=a(7139),s=a(9167);const i=["checked","name","disabled"],o={key:0,for:"#checkbox-field",class:"checkbox-field__label"},r={id:"checkbox-field",class:"checkbox-field__box"},d={key:0,src:s,alt:"Checked"},c={key:0,class:"form-field__error"},u=(0,l.aZ)({emits:["change","update:modelValue"],data(){return{checked:this.$props.modelValue}},computed:{hasError(){return Boolean(this.$props.error)}},watch:{modelValue:{handler(e){this.checked="string"===typeof e?JSON.parse(e):e},immediate:!0}},methods:{check(){this.checked=!this.checked,this.$emit("change",this.checked),this.$emit("update:modelValue",this.checked)}}});var p=(0,l.aZ)({...u,__name:"CheckboxField",props:{name:{},label:{},defaultChecked:{type:Boolean},direction:{default:"right"},variant:{default:"primary"},size:{default:"md"},modelValue:{type:Boolean},disabled:{},error:{},justify:{default:"space-between"}},setup(e){return(e,t)=>((0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("input",{type:"checkbox",class:"checkbox-field__input",checked:e.modelValue||e.checked,name:e.name,disabled:e.disabled},null,8,i),(0,l._)("div",{class:(0,n.C_)(["checkbox-field",{"checkbox-field--checked":e.checked,"checkbox-field--disabled":e.disabled,[`checkbox-field--${e.direction}`]:!0,[`checkbox-field--${e.variant}`]:!0,[`checkbox-field--${e.size}`]:!0}]),style:(0,n.j5)({justifyContent:"space-between"===e.justify?"space-between":"flex-start"}),onClick:t[0]||(t[0]=(...t)=>e.check&&e.check(...t))},[Boolean(e.label)?((0,l.wg)(),(0,l.iD)("label",o,(0,n.zw)(e.$t(e.label)),1)):(0,l.kq)("",!0),(0,l._)("div",r,[e.checked?((0,l.wg)(),(0,l.iD)("img",d)):(0,l.kq)("",!0)])],6),e.hasError?((0,l.wg)(),(0,l.iD)("div",c,(0,n.zw)(e.error),1)):(0,l.kq)("",!0)],64))}});const m=p;var h=m},2619:function(e,t,a){a.d(t,{Z:function(){return d}});var l=a(3396),n=a(7139);const s=["type","placeholder","name","required","value","disabled"],i=(0,l.aZ)({emits:["update:modelValue","blur"],methods:{input(e){const t=e.target?.value;this.$emit("update:modelValue",t)}}});var o=(0,l.aZ)({...i,__name:"InputField",props:{name:{},type:{},placeholder:{},required:{type:Boolean},size:{default:"lg"},variant:{default:"default"},modelValue:{},disabled:{}},setup(e){return(e,t)=>((0,l.wg)(),(0,l.iD)("input",{type:e.type,placeholder:e.placeholder?e.$t(e.placeholder):"",name:e.name,required:e.required,class:(0,n.C_)([`form-field__input--${e.size} form-field__input--${e.variant}`,"form-field__input"]),value:e.modelValue,disabled:e.disabled,onInput:t[0]||(t[0]=t=>e.input(t)),onBlur:t[1]||(t[1]=t=>e.$emit("blur"))},null,42,s))}});const r=o;var d=r},4109:function(e,t,a){a.d(t,{Z:function(){return f}});var l=a(3396),n=a(9242),s=a.p+"img/kebab-icon.addd3d66.svg";const i=(0,l._)("img",{src:s,alt:"Actions"},null,-1),o=[i],r=["data-show"],d={key:0,class:"popover-tooltip__actions"};function c(e,t,a,s,i,c){const u=(0,l.Q2)("click-outside");return(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",{class:"popover",onClick:t[1]||(t[1]=(0,n.iM)((()=>{}),["stop"])),ref:"popover"},[(0,l._)("div",{class:"popover-trigger",ref:"trigger",onClick:t[0]||(t[0]=(...t)=>e.toggle&&e.toggle(...t))},o,512),(0,l._)("div",{class:"popover-tooltip",ref:"tooltip","data-show":e.opened},[e.opened?((0,l.wg)(),(0,l.iD)("div",d,[(0,l.WI)(e.$slots,"actions",{close:e.close,hide:e.hide})])):(0,l.kq)("",!0)],8,r)])),[[u,e.close]])}var u=a(3910),p=(0,l.aZ)({data(){return{opened:!1}},mounted(){const e=this.$refs.trigger,t=this.$refs.tooltip;this.popover=(0,u.fi)(e,t,{placement:"left-start",modifiers:[{name:"offset",options:{offset:[-10,10]}}]})},methods:{toggle(){this.opened=!this.opened,this.popover?.update(),this.popover?.setOptions((e=>({...e,modifiers:[...e.modifiers,{name:"eventListeners",enabled:this.opened}]})))},close(){const e=this.$refs.tooltip;e.style.opacity="1",this.opened=!1},hide(){const e=this.$refs.tooltip;e.style.opacity="0"}}}),m=a(89);const h=(0,m.Z)(p,[["render",c]]);var f=h},8482:function(e,t,a){a.d(t,{Z:function(){return d}});var l=a(3396);function n(e,t,a,n,s,i){return(0,l.WI)(e.$slots,"content",{canRender:e.canRender})}var s=a(6601),i=(0,l.aZ)({props:{rule:{type:String,required:!0}},data(){return{canRender:!1}},mounted(){this.canRender=this.init()},methods:{init(){const e=(0,s.nO)();if(!e)return!1;const t=e.map((e=>e.tag));return t?.includes(this.rule)||!1}}}),o=a(89);const r=(0,o.Z)(i,[["render",n]]);var d=r},2754:function(e,t,a){a.d(t,{Z:function(){return v}});var l=a(3396),n=a(7139);function s(e,t,a,s,i,o){const r=(0,l.up)("v-button"),d=(0,l.up)("v-protected"),c=(0,l.up)("app-loading");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("input",{type:"file",class:"qr-scanner-file",ref:"fileInput",onChange:t[0]||(t[0]=(...t)=>e.onFileGet&&e.onFileGet(...t))},null,544),(0,l.Wm)(d,{rule:e.Rules.ADD_TERMINAL},{content:(0,l.w5)((({canRender:t})=>[(0,l.Wm)(r,{onClick:e.openScan,disabled:!t},{text:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("Додати через фото")),1)])),_:2},1032,["onClick","disabled"])])),_:1},8,["rule"]),(0,l._)("div",{class:(0,n.C_)(["qr-scanner-file__loader",{opened:e.loading}])},[(0,l.Wm)(c,{loading:e.loading},null,8,["loading"])],2)],64)}a(7658);var i=a(4610),o=a(8482),r=a(7863),d=a(5577),c=a(7547),u=a(473);const p=async e=>{const t=new FormData;t.append("file",e);const{data:a}=await c.d.postForm(u.M.SCAN_QR,{file:e});return a};var m=a(4677),h=(0,l.aZ)({emits:["stop:scan"],components:{VButton:i.Z,AppLoading:r.Z,VProtected:o.Z},setup(){const e=(0,m.pm)();return{toast:e,Rules:d.i}},data(){return{loading:!1}},methods:{openScan(){const e=this.$refs.fileInput;e.click()},async onFileGet(e){this.loading=!0;const t=e.target.files[0],a=await p(t);if(0===a.code){const e=!a.id.startsWith("https"),t=new URL(e?`https://localhost/Terminal/Activate?id=${a.id}`:a.id),l=t.pathname+t.search;return this.loading=!1,this.$emit("stop:scan"),void this.$router.push(l)}this.toast.error("Не вдалося розпізнати код. Спробуйте ще раз"),this.loading=!1}}}),f=a(89);const _=(0,f.Z)(h,[["render",s]]);var v=_},117:function(e,t,a){a.r(t),a.d(t,{default:function(){return ge}});var l=a(3396),n=a(7139);const s={class:"terminals-extra-actions"};function i(e,t,a,i,o,r){const d=(0,l.up)("app-loading"),c=(0,l.up)("qr-scanner-link"),u=(0,l.up)("qr-scanner-file"),p=(0,l.up)("add-by-id"),m=(0,l.up)("terminal-filters"),h=(0,l.up)("terminal-table"),f=(0,l.up)("app-layout");return(0,l.wg)(),(0,l.j4)(f,null,{appLoading:(0,l.w5)((()=>[(0,l.Wm)(d,{loading:e.loading},null,8,["loading"])])),appExtra:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l.Wm)(c),(0,l.Wm)(u),(0,l.Wm)(p)])])),appTitle:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("Перегляд терміналів")),1)])),appContent:(0,l.w5)((()=>[(0,l.Wm)(m,{"onUpdate:filters":e.filter},null,8,["onUpdate:filters"]),(0,l.Wm)(h,{data:e.terminals,empty:!e.hasTerminals,total:e.total,"has-pagination":!0},null,8,["data","empty","total"])])),_:1})}var o=a(8231),r=a(7863),d=a(2240),c=a(3e3),u=a(8841);function p(e,t,a,n,s,i){const o=(0,l.up)("terminal-actions"),r=(0,l.up)("v-popover");return(0,l.wg)(),(0,l.j4)(r,null,{actions:(0,l.w5)((({close:t})=>[(0,l.Wm)(o,{onClose:t,terminal:e.terminal},null,8,["onClose","terminal"])])),_:1})}var m=a(4109);const h=["onClick"],f={key:0},_={class:"popover-action__loader"};function v(e,t,a,s,i,o){const r=(0,l.up)("edit-action"),d=(0,l.up)("v-spinner");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(r,{terminal:e.terminal},null,8,["terminal"]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.commands,(t=>((0,l.wg)(),(0,l.iD)("div",{key:t.value,class:"popover-action",onClick:a=>e.sendCommand(t.value)},[e.loading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("span",f,(0,n.zw)(t.label),1)),(0,l._)("div",_,[e.loading?((0,l.wg)(),(0,l.j4)(d,{key:0,color:"accent"})):(0,l.kq)("",!0)])],8,h)))),128))],64)}var g=a(7306),b=a(6265);function k(e,t,a,s,i,o){const r=(0,l.up)("v-protected");return(0,l.wg)(),(0,l.j4)(r,{rule:e.Rules.EDIT_TERMINAL},{content:(0,l.w5)((({canRender:a})=>[(0,l._)("div",{class:(0,n.C_)(["popover-action",{"popover-action--disabled":!a}]),onClick:t[0]||(t[0]=(...t)=>e.openEdit&&e.openEdit(...t))},(0,n.zw)(e.$t("Редагувати")),3)])),_:1},8,["rule"])}a(7658);var w=a(5577),y=a(8482),Z=a(5498),$=(0,l.aZ)({components:{VProtected:y.Z},props:["terminal"],setup(){return{Rules:w.i}},methods:{openEdit(){window.localStorage.setItem(Z.Om,JSON.stringify(this.terminal)),this.$router.push({name:"editTerminal"})}}}),V=a(89);const D=(0,V.Z)($,[["render",k]]);var W=D,x=a(4677),C=(0,l.aZ)({emits:["close"],props:["terminal"],components:{VSpinner:g.Z,EditAction:W},setup(){const e=(0,x.pm)();return{toast:e}},data(){return{loading:!1}},computed:{commands(){const e=this.$store.state.terminals.terminalsRef;if(!e)return[];const t=e.trm_cmd.map((e=>({value:e.id.toString(),label:e.name||""})));return t}},methods:{async sendCommand(e){try{this.loading=!0,await(0,b.WW)({terminal_id:this.terminal.ID,cmd_id:e}),this.loading=!1,this.$emit("close"),this.toast.success("Команду успішно відправлено!")}catch(t){console.log(t)}}}});const R=(0,V.Z)(C,[["render",v]]);var F=R,T=(0,l.aZ)({props:["terminal"],components:{VPopover:m.Z,TerminalActions:F}});const q=(0,V.Z)(T,[["render",p]]);var I=q;const E=(0,l.aZ)({components:{VTable:u.Z}});var A=(0,l.aZ)({...E,__name:"TerminalTable",props:{data:{},empty:{type:Boolean},total:{}},setup(e){const t=(0,c.Cl)(),a=[t.accessor("ID",{cell:e=>{const t=e.getValue(),a=e.row.getIsExpanded(),l=e.row.getToggleExpandedHandler();return(0,d.A)(t,a,l)},header:e=>e.column.id,sortDescFirst:!0}),t.accessor("serial_number",{cell:e=>e.getValue(),header:"SN пристрою",sortDescFirst:!0}),t.accessor("can_offline",{header:"Чи працює оффлайн",cell:e=>JSON.parse(e.getValue()||"false")?"Так":"Ні",sortDescFirst:!0}),t.accessor("max_offline_sum",{header:"Максимальна оффлайн сумма",cell:e=>e.getValue(),sortDescFirst:!0}),t.accessor("last_online",{cell:e=>e.getValue(),header:"Востаннє онлайн",sortDescFirst:!0}),t.accessor("last_start",{cell:e=>e.getValue(),header:"Останній старт",sortDescFirst:!0}),t.accessor("add_time",{cell:e=>e.getValue(),header:"Дата активації",sortDescFirst:!0}),t.display({cell:e=>(0,l.h)(I,{terminal:e.row.original}),header:"Дії"})];return(e,t)=>((0,l.wg)(),(0,l.j4)(u.Z,{data:e.data,columns:a,empty:e.empty,total:e.total},{"context-menu":(0,l.w5)((({values:e})=>[(0,l.Wm)(F,{terminal:e},null,8,["terminal"])])),_:1},8,["data","empty","total"]))}});const S=A;var z=S;function j(e,t,a,s,i,o){const r=(0,l.up)("v-button"),d=(0,l.up)("router-link"),c=(0,l.up)("v-protected");return(0,l.wg)(),(0,l.j4)(c,{rule:e.Rules.ADD_TERMINAL},{content:(0,l.w5)((({canRender:t})=>[(0,l.Wm)(d,{to:{name:"activateTerminal"},class:"terminal-create-btn"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{hasMaxWidth:!1,disabled:!t},{text:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("Додати термінал по номеру")),1)])),_:2},1032,["disabled"])])),_:2},1024)])),_:1},8,["rule"])}var U=a(4610),L=(0,l.aZ)({components:{VProtected:y.Z,VButton:U.Z},setup(){return{Rules:w.i}}});const B=(0,V.Z)(L,[["render",j]]);var N=B,M=a(2754);function O(e,t,a,s,i,o){const r=(0,l.up)("v-button"),d=(0,l.up)("router-link"),c=(0,l.up)("v-protected");return(0,l.wg)(),(0,l.j4)(c,{rule:e.Rules.ADD_TERMINAL},{content:(0,l.w5)((({canRender:t})=>[(0,l.Wm)(d,{to:"/qr"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{disabled:!t},{text:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("Додати термінал через QR-code")),1)])),_:2},1032,["disabled"])])),_:2},1024)])),_:1},8,["rule"])}var G=(0,l.aZ)({components:{VButton:U.Z,VProtected:y.Z},setup(){return{Rules:w.i}}});const H=(0,V.Z)(G,[["render",O]]);var P=H;const Q={class:"filters terminal-filters"},Y={class:"filters-row"},J={class:"filters-item"},K={class:"filters-item"},X={class:"filters-item"},ee={class:"filters-checkbox"},te={class:"filters-actions"};function ae(e,t,a,s,i,o){const r=(0,l.up)("input-field"),d=(0,l.up)("form-field"),c=(0,l.up)("companies-filter"),u=(0,l.up)("checkbox-field"),p=(0,l.up)("v-button");return(0,l.wg)(),(0,l.iD)("div",Q,[(0,l._)("div",Y,[(0,l._)("div",J,[(0,l.Wm)(d,{shadow:!0,small:"",label:"Термінал"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"terminal_name",modelValue:e.filters.terminal_id,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filters.terminal_id=t),placeholder:"Термінал ID",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,l._)("div",K,[(0,l.Wm)(d,{shadow:!0,small:"",label:"ID ПТКС"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"ptks_num",modelValue:e.filters.ptks_num,"onUpdate:modelValue":t[1]||(t[1]=t=>e.filters.ptks_num=t),placeholder:"ID ПТКС",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,l.Wm)(c,{modelValue:e.filters.company_id,"onUpdate:modelValue":t[2]||(t[2]=t=>e.filters.company_id=t)},null,8,["modelValue"]),(0,l._)("div",X,[(0,l.Wm)(d,{shadow:!0,small:"",label:"SN пристрою"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"serial_number",modelValue:e.filters.serial_number,"onUpdate:modelValue":t[3]||(t[3]=t=>e.filters.serial_number=t),placeholder:"SN пристрою",disabled:!1,size:"sm"},null,8,["modelValue"])])),_:1})]),(0,l._)("div",ee,[(0,l.Wm)(u,{name:"test_mode",modelValue:e.filters.test_mode,"onUpdate:modelValue":t[4]||(t[4]=t=>e.filters.test_mode=t),label:"У тестовому режимі",direction:"left",justify:"none"},null,8,["modelValue"])]),(0,l._)("div",te,[(0,l.Wm)(p,{"has-max-width":!1,type:"button",onClick:e.applyFilter},{text:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("Фільтрувати")),1)])),_:1},8,["onClick"])])])])}var le=a(4560),ne=a(2619);const se={key:0,class:"filters-item filters-companies-select"};function ie(e,t,a,n,s,i){const o=(0,l.up)("select-field"),r=(0,l.up)("form-field");return e.companies.length?((0,l.wg)(),(0,l.iD)("div",se,[(0,l.Wm)(r,{label:"Компанії",small:"",shadow:""},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{options:e.companies,name:"companies","input-placeholder":"Оберіть компанію","search-placeholder":"Введіть компанію","has-search":!1,"model-value":e.modelValue,"onUpdate:modelValue":e.select,size:"sm",disabled:e.disabled},null,8,["options","model-value","onUpdate:modelValue","disabled"])])),_:1})])):(0,l.kq)("",!0)}a(541);var oe=a(2946),re=(0,l.aZ)({props:{modelValue:String,small:{type:Boolean,required:!1},disabled:{required:!1}},emits:["update:modelValue","blur"],components:{FormField:le.Z,SelectField:oe.Z},computed:{companies(){const e=this.$store.state.terminals.terminalsRef;if(!e)return[];const t=e.parent_child.map((e=>({value:e.id.toString(),label:e.name||""})));return t.unshift({value:"",label:"Не обрано"}),t}},methods:{select(e){this.$emit("update:modelValue",e),this.$emit("blur",e)}}});const de=(0,V.Z)(re,[["render",ie]]);var ce=de,ue=a(2729),pe=(0,l.aZ)({emits:["update:filters"],components:{FormField:le.Z,InputField:ne.Z,VButton:U.Z,CompaniesFilter:ce,CheckboxField:ue.Z},data(){return{filters:{terminal_id:"",ptks_num:"",company_id:"",test_mode:"false",serial_number:""}}},mounted(){this.filters={...this.filters,...this.$route.query}},watch:{"$route.query":{handler(e){this.filters={...this.filters,...e}},deep:!0,immediate:!0}},methods:{applyFilter(){const e=Object.fromEntries(Object.entries(this.$data.filters).filter((([e,t])=>"boolean"===typeof t||Boolean(t))));this.$router.replace({path:this.$route.path,query:e}),this.$emit("update:filters",e)}}});const me=(0,V.Z)(pe,[["render",ae]]);var he=me,fe=a(5384),_e=(0,l.aZ)({components:{AppLayout:o.Z,TerminalTable:z,AppLoading:r.Z,QrScannerLink:P,AddById:N,QrScannerFile:M.Z,TerminalFilters:he},computed:{loading(){return this.$store.state.terminals.loading},terminals(){return this.$store.state.terminals.terminals},hasTerminals(){return this.$store.state.terminals.terminals&&this.$store.state.terminals.terminals.length>0},total(){return this.$store.state.terminals.total}},watch:{"$route.query":{handler(e){this.filter(e)},deep:!0,immediate:!0}},mounted(){this.$store.dispatch(fe.T.GET_TERMINALS_REF)},beforeUnmount(){this.$store.dispatch(fe.T.CLEAR_TERMINALS)},methods:{filter(e){this.$store.dispatch(fe.T.GET_TERMINALS,e)}}});const ve=(0,V.Z)(_e,[["render",i]]);var ge=ve},9167:function(e,t,a){e.exports=a.p+"img/check-icon.972bc3c4.svg"}}]);
//# sourceMappingURL=3802.ccf02858.js.map